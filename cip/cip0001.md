---
author: "Neil Lawrence"
created: "2026-02-08"
id: "0001"
last_updated: "2026-02-08"
status: "Accepted"
compressed: false
related_requirements:
  - "0001"
tags:
- cip
- architecture
- sklearn-api
title: "Scikit-learn Compatible Package Architecture"
---

# CIP-0001: Scikit-learn Compatible Package Architecture

> **Note**: This CIP describes HOW to structure the Python implementation to meet REQ-0001.

## Status

- [x] Proposed - Initial idea documented
- [x] Accepted - Approved, ready to start work
- [ ] In Progress - Actively being implemented
- [ ] Implemented - Work complete, awaiting verification
- [ ] Closed - Verified and complete

## Summary

Design the Python package architecture using scikit-learn conventions, with modular components for affinity matrix, Laplacian, elongated k-means, and the main clustering algorithm.

**Which requirements does this CIP address?** REQ-0001 (Python Implementation of Spectral Clustering Algorithm)

## Motivation

The Python implementation needs to be:
1. Familiar to Python ML practitioners (use scikit-learn conventions)
2. Modular and testable (separate concerns for each algorithm component)
3. Easy to install and integrate (standard Python packaging)

Following scikit-learn conventions makes the package immediately usable in ML pipelines and familiar to the majority of Python data scientists.

## Detailed Description

### Package Structure

```
spectral/
├── pyproject.toml              # Modern package config
├── README.md                    # Installation and quick start
├── spectral/                    # Main package
│   ├── __init__.py             # Exports SpectralCluster
│   ├── cluster.py              # Main SpectralCluster class
│   ├── affinity.py             # Affinity matrix functions
│   ├── kmeans.py               # Elongated k-means
│   └── _validation.py          # Input validation helpers
├── examples/                    # Jupyter notebooks (see CIP-0002)
│   └── data/                   # Example datasets
├── tests/                       # Pytest test suite
│   ├── test_affinity.py
│   ├── test_kmeans.py
│   ├── test_cluster.py
│   └── test_matlab_equivalence.py
└── matlab/                      # Original MATLAB code (preserved)
```

### Core API Design

```python
from sklearn.base import BaseEstimator, ClusterMixin

class SpectralCluster(BaseEstimator, ClusterMixin):
    """
    Spectral clustering with automatic cluster number determination.
    
    Parameters
    ----------
    sigma : float
        Scale parameter for RBF kernel
    lambda_ : float, default=0.2
        Elongation parameter for distance metric
    max_clusters : int, default=10
        Maximum number of eigenvectors to compute
    epsilon : float, default=0.0001
        Threshold for origin proximity
    random_state : int or None, default=None
        Random seed for reproducibility
        
    Attributes
    ----------
    labels_ : ndarray of shape (n_samples,)
        Cluster labels for each sample
    n_clusters_ : int
        Number of clusters found
    centers_ : ndarray
        Cluster centers in eigenspace
    eigenvectors_ : ndarray
        Eigenvectors used for clustering
    eigenvalues_ : ndarray
        Corresponding eigenvalues
    """
    
    def __init__(self, sigma, lambda_=0.2, max_clusters=10, 
                 epsilon=0.0001, random_state=None):
        # Store all params as-is (sklearn convention)
        self.sigma = sigma
        self.lambda_ = lambda_
        self.max_clusters = max_clusters
        self.epsilon = epsilon
        self.random_state = random_state
        
    def fit(self, X, y=None):
        """Perform clustering on X."""
        # Returns self for chaining
        return self
        
    def fit_predict(self, X, y=None):
        """Perform clustering and return labels."""
        return self.fit(X).labels_
```

### Modular Components

**affinity.py**:
- `build_affinity_matrix(X, sigma)` - RBF kernel affinity
- `normalize_laplacian(A)` - Symmetric normalization

**kmeans.py**:
- `ElongatedKMeans` class or `elongated_kmeans()` function
- `mahalanobis_distance(x, center, lambda_)` - Distance metric from paper equation (1)

**cluster.py**:
- `SpectralCluster` - Main algorithm following Algorithm 2 from paper

### Dependencies

Core:
- numpy >= 1.20
- scipy >= 1.7  
- scikit-learn >= 1.0
- matplotlib >= 3.3

Dev:
- pytest >= 7.0
- jupyter >= 1.0

### Why scikit-learn API?

1. **Familiarity**: Vast majority of Python ML users know sklearn
2. **Interoperability**: Works with Pipeline, GridSearchCV, etc.
3. **Documentation**: Standard conventions for docstrings
4. **Validation**: Use sklearn's input validation utilities

## Implementation Plan

1. **Set up package structure**:
   - Create pyproject.toml with dependencies
   - Set up directory structure
   - Make package pip-installable

2. **Implement affinity module**:
   - `build_affinity_matrix()` - vectorized RBF computation
   - `normalize_laplacian()` - D^(-1/2) * A * D^(-1/2)
   - Unit tests against hand-computed values

3. **Implement elongated k-means**:
   - Mahalanobis distance function
   - K-means loop with center initialization
   - Unit tests for radial cluster separation

4. **Implement main algorithm**:
   - SpectralCluster class inheriting from BaseEstimator
   - Iterative eigenspace expansion logic
   - Integration tests on three circles

5. **Validate against MATLAB**:
   - Run MATLAB code to generate reference outputs
   - Create regression tests comparing Python to MATLAB
   - Document any numerical differences

## Backward Compatibility

This is a new implementation, no backward compatibility concerns.

## Testing Strategy

- **Unit tests**: Each component tested independently
- **Integration tests**: Three circles must produce 3 clusters
- **MATLAB equivalence**: Outputs match within tolerance (1e-6)
- **Edge cases**: Single cluster, degenerate geometries
- **Coverage**: Aim for >85% code coverage

## Related Requirements

This CIP addresses:
- REQ-0001: Python Implementation of Spectral Clustering Algorithm

Specifically implements:
- Modular architecture for algorithm components
- Scikit-learn compatible API
- Standard Python packaging

## Implementation Status
- [ ] Package structure created
- [ ] Affinity module implemented
- [ ] Elongated k-means implemented
- [ ] Main SpectralCluster class implemented
- [ ] Tests passing
- [ ] MATLAB validation complete

## References
- REQ-0001: Python Implementation requirement
- Paper: Sanguinetti et al. (2005)
- Scikit-learn API: https://scikit-learn.org/stable/developers/develop.html
